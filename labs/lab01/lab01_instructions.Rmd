---
title: "432 Homework 1"
output: github_document
---

```{r set-options, echo=FALSE, cache=FALSE, message = FALSE}
knitr::opts_chunk$set(comment=NA)

library(here)
library(Hmisc)
library(magrittr)
library(tidyverse)
```

Version: `r Sys.time()`

# General Instructions

Submit your work via [Canvas](https://canvas.case.edu/). The deadline is specified on [the Course Calendar](https://github.com/THOMASELOVE/432/calendar.html).

Your response should include an R Markdown file and an HTML document that is the result of applying your R Markdown file to the `hbp3456.csv` data, available on [our Data and Code page](https://github.com/THOMASELOVE/432-data), as well as [in the data subfolder](https://github.com/THOMASELOVE/432-2021/tree/master/labs/lab01/data) for this Lab. 

Start a separate R Project for Lab 1, as your first step, and place the data in that project's directory or (if you want to match what I did) in a data sub-directory under that project's directory.

## The `hbp3456` data

The (simulated) data in the `hbp3456` file describe a total of 3456 people living with hypertension (high blood pressure) diagnoses who receive primary care in one of eight practices.

- In each of the eight practices, 432 (different) individuals (who I'll call subjects in what follows) were sampled at random from all eligible subjects. 
- The data are based on real electronic health record (EHR) data, but with some noise added. 
    - The practices are named after streets that appear in *The Simpsons*. 
    - There are 62 (fictional) providers identified across the eight practices, and each provider cares for subjects within a single practice.

### Eligibility Criteria

The data are cross-sectional and describe results from a one-year reporting window. To be eligible for the study, a subject had to meet all of the following criteria:

- have an EHR-documented hypertension diagnosis which applied during the one-year reporting window,
- cared for at one of the eight practices in this study, and by one of the 62 participating providers in this study
- age 25 or older at the start of the one-year reporting period (note that all subjects with ages 80 and higher are listed as age 80 in the data)
- between 1 and 12 primary care office visits in the one-year reporting period
- between 2 and 24 primary care office visits combined across the reporting period and the previous year
- fall into one of two biological sex categories (female or male)
- fall into one of four primary insurance categories, specifically Medicare, Commercial, Medicaid or Uninsured.
- have a most recent systolic BP between 80 and 220 mm Hg and most recent diastolic BP between 40 and 140 mm Hg, where the systolic BP is at least 15 and no more than 130 mm Hg larger than the diastolic BP.

### Codebook

Variable    | Description
----------: | --------------------------------------------------------------------------------------------------------
`record`    | unique code for each subject (six digits, first digit is 9, last indicates practice)
`practice`  | primary care practice, of which there are eight in the data
`provider`  | primary care provider (each practice has multiple providers)
`age`       | subject's age as of the start of the reporting period
`race`      | subject's race (4 levels: Asian, AA_Black, White, Other)
`eth_hisp`  | is subject of Hispanic/Latino ethnicity? Yes or No
`sex`       | subject's sex (F or M)
`insurance` | subject's primary insurance (Medicare, Commercial, Medicaid, Uninsured)
`income`    | estimated median income of subject's home neighborhood (via American Community Survey, to nearest $100)
`hsgrad`    | estimated percentage of adults living in the subject's home neighborhood who have graduated from high school (via American Community Survey, to the nearest tenth of a percent)
`tobacco`   | tobacco use status (Current, Former, or Never)
`depdiag`   | does subject have depression diagnosis? Yes or No
`height`    | subject's height in meters, rounded to two decimal places
`weight`    | subject's weight in kilograms, rounded to one decimal place
`ldl`       | subject's LDL cholesterol level, in mg/dl
`statin`    | does subject have a current prescription for a statin medication? Yes or No
`bpmed`     | does subject have a current prescription for a blood pressure control medication? Yes or No
`sbp`       | subject's most recently obtained systolic blood pressure, in mm Hg
`dbp`       | subject's most recently obtained diastolic blood pressure, in mm Hg
`visits_1`  | subject's number of visits for primary care in reporting period (one year)
`visits_2`  | subject's visits for primary care in the past two years
`acearb`    | does subject have a current prescription for an ACE-inhibitor or ARB? Yes or No
`betab`     | does subject have a current prescription for a beta-blocker? Yes or No

### Notes on Specific Variables

- The list of medications included in `bpmed` is: ACE-inhibitor, ARB, Diuretic, Calcium-Channel Blocker, Beta-Blocker, Alpha-1 Blocker, Centrally acting Alpha-2 Agonist, Vasodilator or other antihypertensive agents. A subject with a current prescription for any of these will have a Yes in `bpmed`. 
- For the `acearb`, `betab`, `bpmed`, `statin` and `depdiag` variables, a No response includes all subjects where there's no evidence in the EHR of meeting the Yes criterion, so that there are no missing values (a missing value is interpreted there as No.)
- For the `height`, `weight` and `ldl` results, implausible values were treated as missing in preparing the data for you. 
- The `race` and `eth_hisp` values are self-reported, and some subjects refused to answer one or both of the relevant questions. 
- The `income` and `hsgrad` values are imputed from the subject's home address, usually at the census block level, but occasionally at the level of the zip code. 
    - When a subject's home address could not be geocoded, these values are noted as missing.
    - Geocoded estimates of `income` below 6500 are reported as 6500, and estimates above 130000 are reported as 130000. 
    - For `hsgrad`, geocoded estimates below 40 are reported as 40, and estimates above 99.9 are reported as 99.9.

## Summarizing the Complete Data

Here's a summary of the data using the `describe` function in the `Hmisc` package.

```{r, message = FALSE, warning = FALSE}
lab1 <- read_csv(here("data", "hbp3456.csv")) # reads the hbp3456.csv file
                                             # from the data subfolder

lab1 <- lab1 %>%
    mutate(record = as.character(record))

describe(lab1) # from the Hmisc package
```

## Question 1. (40 points)

Build a Table 1 to compare the subjects in the **Highland** practice to the subjects in the **Sycamore** practice on the following nine variables: 

- age, 
- race, 
- Hispanic ethnicity, 
- sex, 
- primary insurance, 
- body mass index, 
- BMI category, 
- systolic blood pressure, and
- diastolic blood pressure. 

Make the Table as well as you can within R Markdown, and display the result as part of your HTML file. All code must be visible to us. **Include a description of the important results from your Table 1 that does not exceed 100 words, using complete English sentences**.

1. Be sure that your table specifies the number of subjects in each practice. **Note that you'll have to do something so that your work focuses on the comparison of Highland to Sycamore, leaving out (for this question only) the other practices.**
2. You'll have to deal with some missing values in the data. All missing values are indicated in the .csv file with NA. It's not usually appropriate to report results that include imputation in a Table 1, so build a note specifying the amount of missing data in a footnote to the table. An appropriate approach would be to list these notes as a bulleted list in the Markdown file just below your Table. 
3. Some variables will present as characters in the data, but you'd instead prefer them to appear as **factors**. Be sure to include code in your response to make these changes (the `forcats` package is your friend here) and then (perhaps using the `fct_relevel` function in the `forcats` package) be sure to move the levels of those factors into an order that facilitates interpretation.
4. Be sure, too, to make reasoned choices about whether means and standard deviations or instead medians and quartiles are more appropriate displays for the quantitative variables. Include your reasons in your bulleted list of footnotes at the end of your table. Note that the `record` information is just a code (even though it is numerical) and should be treated as a character variable in using these data, as I did above.
5. Note that body mass index (BMI) and BMI category are not supplied in the data, although you do have height and weight. **So, you'll have to calculate the BMI and add it to the data set.** If you don't know the formula for BMI, you have Google to help you figure it out.
6. For BMI categories, use the four groups specified in the [How is BMI interpreted for Adults section of this description](https://www.cdc.gov/healthyweight/assessing/bmi/adult_bmi/index.html) of Adult BMI by the Centers for Disease Control. **Again, you'll need to use your calculated BMI values and then create the categories in your data set, and you'll need to figure out a way to accurately get each subject into the correct category.**
7. Do not include R output without complete sentences describing what you are doing in each step, and what you conclude from that work.

## Question 2. (20 points)

Now, look at the complete data, describing all eight practices (the names are Center, Elm, Highland, King, North, Plympton, Sycamore and Walnut.) 

Does which **insurance** status a person has seem to have a meaningful impact on their **systolic blood pressure**, adjusting for whether or not they have a prescription for a **beta-blocker**? Decide whether your model should include an interaction term in a sensible way (providing a graph to help us understand your reasoning), and then fit your choice of model using the `lm` function in R. 

**Be sure to provide a written explanation of your findings, in complete sentences**. In that explanation, you should address both the overall quality of fit and the interpretation of the coefficients of your chosen model. 

1. As a hint, one graph you might use would be one to assess the need for an interaction term. Another graph (or perhaps table) to consider for insight would look at the relationship between **insurance** and **beta-blocker** status in these subjects.
2. Do not include R output without complete sentences describing what you are doing in each step, and what you conclude from that work.

## Question 3. (20 points)

Identify an important idea which resonates for you from your reading of the Introduction to Nate Silver's *The Signal and the Noise*. Please identify a specific example of how this idea has helped or might help you deal with an issue that comes up in your life as a scientist.

Write a short essay (between 150 and 250 words is appropriate) using clearly constructed and complete sentences to respond to this. The essay should be composed using R Markdown.

- We encourage you to provide brief citations or quotes from Silver and elsewhere as needed. 
- In citing *The Signal and the Noise* a quotation with (Silver, Introduction) or (Silver, Chapter 1), for example, is sufficient. 
- In citing another work, a more detailed citation is appropriate. Citations and quotations do not count towards the suggested word limit.

## Question 4. (10 points)

Please verify your presence on Piazza by placing a non-anonymous post in the **lab01_music** folder [on Piazza](https://piazza.com/case/spring2021/pqhs432) describing your favorite kind of music. You can specify a kind of music, a favorite song, or recording artist. A single sentence is sufficient for this task. 

- We simply want to verify that you can post on Piazza, and gather a little more information about what people taking this class like to listen to. 
- Dr. Love has provided his own post on this issue in the **lab01_music** folder on Piazza.

In your R Markdown and HTML file in response to this assignment, for Question 4, I suggest you write: "I have posted on Piazza in response to Question 4."

## Question 5. (10 points)

Please tell us your Github user name. 

- To sign up for a (free) Github account, visit github.com and click on the Sign up button (usually, it's on the top right.)
- To learn more about Git and Github, we recommend https://happygitwithr.com/.

## Please add the session information.

Finally, at the end of this lab and all subsequent assignments (including the projects), please add the session information. My preferred way for you to do this for 432 is...

```{r, eval = FALSE}
xfun::session_info()
```

the results of which are shown at the bottom of this page.

### End of Homework 1

```{r}
xfun::session_info()
```

