---
title: "432 Homework 1"
output: github_document
---

```{r set-options, echo=FALSE, cache=FALSE, message = FALSE}
knitr::opts_chunk$set(comment=NA)

library(here)
library(janitor)
library(magrittr)
library(tidyverse)
```

# General Instructions

Submit your work via [Canvas](https://canvas.case.edu/). The deadline is specified on [the Course Calendar](https://github.com/THOMASELOVE/432/calendar.html).

Your response should include an R Markdown file and an HTML document that is the result of applying your R Markdown file to the `hbp3456.csv` data, available in the data subfolder for this homework, as well as on our Data and Code page. Start a separate R Project for Homework 1, as your first step, and place the data in that project's directory or (if you want to match what I did) in a data sub-directory.

## The `hbp3456` data

The (simulated) data describe a total of 3456 individuals living with hypertension (high blood pressure) diagnoses who receive primary care in one of eight practices. 432 (different) individuals were sampled from each practice. The data are based on real electronic health records, but with some noise added. The practices are named after streets that appear in *The Simpsons* and the identification of providers are fictional.

Variable    | Description
----------: | --------------------------------------------------------------------------------------------------------
`record`    | unique code for each subject (six digits, first digit is 9, last indicates practice)
`practice`  | primary care practice, of which there are eight in the data
`provider`  | primary care provider (each practice has multiple providers)
`age`       | subject's age as of the start of the reporting period
`race`      | subject's race (4 levels: Asian, AA_Black, White, Other)
`eth_hisp`  | is subject of Hispanic/Latino ethnicity? Yes or No
`sex`       | subject's sex (F or M)
`insurance` | subject's primary insurance (Medicare, Commercial, Medicaid, Uninsured)
`income`    | estimated median income of subject's home neighborhood (via American Community Survey, to nearest $100)
`hsgrad`    | estimated percentage of adults living in the subject's home neighborhood who have graduated from high school (via American Community Survey, to the nearest tenth of a percent)
`tobacco`   | tobacco use status (Current, Former, or Never)
`depdiag`   | does subject have depression diagnosis? Yes or No
`height`    | subject's height in meters, rounded to two decimal places
`weight`    | subject's weight in kilograms, rounded to one decimal place
`ldl`       | subject's LDL cholesterol level, in mg/dl
`statin`    | does subject have a current prescription for a statin medication? Yes or No
`bpmed`     | does subject have a current prescription for a blood pressure control medication? Yes or No
`sbp`       | subject's most recently obtained systolic blood pressure, in mm Hg
`dbp`       | subject's most recently obtained diastolic blood pressure, in mm Hg
`visits_1`  | subject's number of visits for primary care in reporting period (one year)
`visits_2`  | subject's visits for primary care in the past two years
`acearb`    | does subject have a current prescription for an ACE-inhibitor or ARB? Yes or No
`betab`     | does subject have a current prescription for a beta-blocker? Yes or No

The list of medications included in `bpmed` is: ACE-inhibitor, ARB, Diuretic, Calcium-Channel Blocker, Beta-Blocker, Alpha-1 Blocker, Centrally acting Alpha-2 Agonist, Vasodilator or other antihypertensive agents. A subject with a current prescription for any of these will have a Yes in `bpmed`.

Here's a quick glimpse of the data.

```{r, message = FALSE, warning = FALSE}
hw1 <- read_csv(here("data", "hbp3456.csv"))
hw1 <- hw1 %>%
    mutate(record = as.character(record))

mosaic::inspect(hw1)
```


## Question 1. (40 points)

Build a Table 1 to compare the subjects in the Highland practice to the subjects in the Sycamore practice on the following nine variables: age, race, Hispanic ethnicity, sex, primary insurance, body mass index, BMI category, and systolic and diastolic blood pressure. Make the Table as well as you can within R Markdown, and display the result as part of your HTML file. **Include a description of the important results from your Table 1 that does not exceed 100 words, using complete English sentences**.

1. Be sure that your table specifies the number of subjects in each practice. **Note that you'll have to do something so that your work focuses on the comparison of Highland to Sycamore, leaving out (for this question only) the other practices.**
2. You'll have to deal with some missingness in the data, in an appropriate way. Be sure to specify what you did with the missing data (and how much you had to deal with) in a footnote to the table. Specifically, list the notes as a bulleted list in the Markdown file, and never leave Markdown during the entire enterprise. It's not usually appropriate to report results that include imputation in a Table 1, so I expect the best choice is to build a note specifying the amount of missing data.
3. Some variables will present as characters in the data if you import it as I did above, but you'd instead prefer them to appear as **factors**. Be sure to include code in your response to make these changes (the `forcats` package is your friend here) and then (perhaps using the `fct_relevel` function in the `forcats` package) be sure to move the levels of those factors into an order that facilitates interpretation.
4. Be sure, too, to make reasoned choices about whether means and standard deviations or instead medians and quartiles are more appropriate displays for the quantitative variables. Include your reasons in your bulleted list of footnotes at the end of your table.
5. Note that body mass index (BMI) and BMI category are not supplied in the data, although you do have height and weight. **So, you'll have to calculate the BMI and add it to the data set.** If you don't know the formula for BMI, you have Google to help you figure it out.
6. For BMI categories, use the four groups specified in the [How is BMI interpreted for Adults section of this description](https://www.cdc.gov/healthyweight/assessing/bmi/adult_bmi/index.html) of Adult BMI by the Centers for Disease Control. **Again, you'll need to use your calculated BMI values and then create the categories in your data set, and you'll need to figure out a way to accurately get each subject into the correct category.**
7. Do not include R output without complete sentences describing what you are doing in each step, and what you conclude from that work.

## Question 2. (20 points)

Now, look at the complete data, describing all eight practices (the names are Center, Elm, Highland, King, North, Plympton, Sycamore and Walnut.) 

Does which **insurance** status a person has seem to have a meaningful impact on their **systolic blood pressure**, adjusting for whether or not they have a prescription for a **beta-blocker**? Decide whether your model should include an interaction term in a sensible way (providing a graph to help us understand your reasoning), and then fit your choice of model using a linear model. Be sure to provide a written explanation of your findings, in complete sentences. In that explanation, you should address both the overall quality of fit and the interpretation of the coefficients of your chosen model. 

1. As a hint, one graph you might use would be one to assess the need for an interaction term. Another graph (or perhaps table) to consider for insight would look at the relationship between **insurance** and **beta-blocker** status in these subjects.
2. Do not include R output without complete sentences describing what you are doing in each step, and what you conclude from that work.

## Question 3. (20 points)

Question from Silver. 

Write an essay of 150-250 words (using complete sentences, and examples derived from your modeling) that explains how this advice is connected to your thinking about presenting your results.

## Question 4. (10 points)

Please verify your presence on Piazza by placing a non-anonymous post in the **lab01_music** folder [on Piazza](https://piazza.com/case/spring2021/pqhs432) describing your favorite kind of music. You can specify a kind of music, a favorite song, or recording artist. A single sentence is sufficient for this task. We simply want to verify that you can post on Piazza, and gather a little more information about what people taking this class like to listen to. Dr. Love has provided his own post on this issue in the **lab01_music** folder on Piazza.

## Question 5. (10 points)

Please tell us your Github user name. To learn more about Git and Github, we recommend https://happygitwithr.com/.

## Please add the session information.

Finally, at the end of this homework and all subsequent assignments (including the projects), please add the session information. My preferred way for you to do this is...

```{r, eval = FALSE}
xfun::session_info()
```

the results of which are shown at the bottom of this page.

### End of Homework 1

```{r}
xfun::session_info()
```

